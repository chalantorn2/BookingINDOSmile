<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>INDO Smile Booking Form</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css" />
  </head>

  <body>
    <menu-component></menu-component>

    <div class="container py-5">
      <div class="text-center mb-5">
        <h1 class="mb-3">INDO Smile Booking</h1>
        <p class="lead">กรุณาเลือกฟอร์มที่ต้องการกรอก</p>
        <a
          href="/frontend/main/view.html"
          class="gap-2 col-3 mx-auto btn btn-secondary"
          >View Bookings</a
        >
        <a
          href="/frontend/order/viewOrder.html"
          class="gap-2 col-3 mx-auto btn btn-secondary"
          >View Order</a
        >
      </div>

      <!-- เลือกประเภทฟอร์ม -->
      <div class="d-flex justify-content-center mb-4">
        <div class="btn-group" role="group">
          <input
            type="radio"
            class="btn-check"
            name="formType"
            id="formTour"
            value="tour"
            autocomplete="off"
          />
          <label class="btn btn-outline-primary" for="formTour">Tour</label>

          <input
            type="radio"
            class="btn-check"
            name="formType"
            id="formTransfer"
            value="transfer"
            autocomplete="off"
          />
          <label class="btn btn-outline-primary" for="formTransfer"
            >Transfer</label
          >
        </div>
      </div>

      <!-- ฟอร์ม Tour -->
      <div class="card shadow-sm d-none" id="tourCard">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Tour Booking Form</h5>
        </div>
        <div class="card-body">
          <form id="tourForm">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label for="tourAgent" class="form-label">Agent</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourAgent"
                  name="tourAgent"
                  placeholder="ใส่ชื่อ Agent"
                />
              </div>
              <div class="col-md-6">
                <label for="tourSendTo" class="form-label">ส่งใคร</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourSendTo"
                  name="tourSendTo"
                  placeholder="ส่งงานให้ใคร"
                />
              </div>
            </div>
            <div class="row g-4 mb-3">
              <div class="col-md-4">
                <label for="tourFirstNameCustomer" class="form-label"
                  >ชื่อ</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="tourFirstNameCustomer"
                  name="tourFirstNameCustomer"
                  placeholder="ชื่อลูกค้า"
                />
              </div>
              <div class="col-md-4">
                <label for="tourLastNameCustomer" class="form-label"
                  >นามสกุล</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="tourLastNameCustomer"
                  name="tourLastNameCustomer"
                  placeholder="นามสกุลลูกค้า"
                />
              </div>
              <div class="col-md-4">
                <label for="tourPax" class="form-label">จำนวน</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourPax"
                  name="tourPax"
                  placeholder="จำนวนคน"
                />
              </div>
            </div>
            <div class="mb-3">
              <label for="tourType" class="form-label">ประเภท</label>
              <input
                type="text"
                class="form-control"
                id="tourType"
                name="tourType"
                placeholder="ประเภททัวร์"
              />
            </div>

            <div class="mb-3">
              <label for="tourDetail" class="form-label">รายละเอียด</label>
              <textarea
                class="form-control"
                id="tourDetail"
                name="tourDetail"
                rows="3"
                placeholder="รายละเอียดทัวร์"
              ></textarea>
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label for="tourFee" class="form-label">FEE</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourFee"
                  name="tourFee"
                  placeholder="ค่าทัวร์"
                />
              </div>
              <div class="col-md-4">
                <label for="tourMeal" class="form-label">MEAL</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourMeal"
                  name="tourMeal"
                  placeholder="อาหารที่รวม"
                />
              </div>
              <div class="col-md-4">
                <label for="tourDate" class="form-label">Date</label>
                <input
                  type="date"
                  class="form-control"
                  id="tourDate"
                  name="tourDate"
                  required
                />
              </div>
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label for="tourHotel" class="form-label">โรงแรม</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourHotel"
                  name="tourHotel"
                  placeholder="ชื่อโรงแรมที่พัก"
                />
              </div>
              <div class="col-md-6">
                <label for="tourRoomNo" class="form-label"
                  >หมายเลขห้องพัก</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="tourRoomNo"
                  name="tourRoomNo"
                  placeholder="หมายเลขห้องพัก"
                />
              </div>
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label for="tourContactNo" class="form-label"
                  >Contact No.</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="tourContactNo"
                  name="tourContactNo"
                  placeholder="เบอร์ติดต่อ"
                />
              </div>
              <div class="col-md-6">
                <label for="tourPickUpTime" class="form-label">เวลารับ</label>
                <input
                  type="text"
                  class="form-control"
                  id="tourPickUpTime"
                  name="tourPickUpTime"
                  placeholder="HH:MM"
                />
              </div>
            </div>

            <div class="mb-3">
              <label for="tourNote" class="form-label">หมายเหตุ</label>
              <textarea
                class="form-control"
                id="tourNote"
                name="tourNote"
                rows="3"
                placeholder="หมายเหตุเพิ่มเติม"
              ></textarea>
            </div>

            <button type="submit" class="btn btn-primary btn-lg mt-3">
              บันทึก
            </button>
          </form>
        </div>
      </div>

      <!-- ฟอร์ม Transfer -->
      <div class="card shadow-sm d-none mt-4" id="transferCard">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Transfer Booking Form</h5>
        </div>
        <div class="card-body">
          <form id="transferForm">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label for="transferAgent" class="form-label">Agent</label>
                <input
                  type="text"
                  class="form-control"
                  id="transferAgent"
                  name="transferAgent"
                  placeholder="ใส่ชื่อ Agent"
                />
              </div>
              <div class="col-md-6">
                <label for="transferSendTo" class="form-label">ส่งใคร</label>
                <input
                  type="text"
                  class="form-control"
                  id="transferSendTo"
                  name="transferSendTo"
                  placeholder="ส่งงานให้ใคร"
                />
              </div>
            </div>
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label for="transferFirstNameCustomer" class="form-label"
                  >ชื่อ</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="transferFirstNameCustomer"
                  name="transferFirstNameCustomer"
                  placeholder="ชื่อลูกค้า"
                />
              </div>
              <div class="col-md-4">
                <label for="transferLastNameCustomer" class="form-label"
                  >นามสกุล</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="transferLastNameCustomer"
                  name="transferLastNameCustomer"
                  placeholder="นามสกุลลูกค้า"
                />
              </div>
              <div class="col-md-4">
                <label for="transferPax" class="form-label">จำนวน</label>
                <input
                  type="text"
                  class="form-control"
                  id="transferPax"
                  name="transferPax"
                  placeholder="จำนวนคน"
                />
              </div>
            </div>

            <div class="mb-3">
              <label for="transferType" class="form-label">ประเภท</label>
              <input
                type="text"
                class="form-control"
                id="transferType"
                name="transferType"
                placeholder="ประเภทการรับ-ส่ง"
              />
            </div>

            <div class="mb-3">
              <label for="transferDetail" class="form-label">รายละเอียด</label>
              <textarea
                class="form-control"
                id="transferDetail"
                name="transferDetail"
                rows="3"
                placeholder="รายละเอียดการรับ-ส่ง"
              ></textarea>
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label for="transferFlight" class="form-label">Flight</label>
                <input
                  type="text"
                  class="form-control"
                  id="transferFlight"
                  name="transferFlight"
                  placeholder="เที่ยวบิน"
                />
              </div>
              <div class="col-md-4">
                <label for="transferTime" class="form-label">Flight Time</label>
                <input
                  type="text"
                  class="form-control"
                  id="transferTime"
                  name="transferTime"
                  placeholder="HH:MM"
                />
              </div>
              <div class="col-md-4">
                <label for="transferDate" class="form-label">Date</label>
                <input
                  type="date"
                  class="form-control"
                  id="transferDate"
                  name="transferDate"
                  required
                />
              </div>
            </div>

            <div class="mb-3">
              <label for="transferPickUpTime" class="form-label">เวลารับ</label>
              <input
                type="text"
                class="form-control"
                id="transferPickUpTime"
                name="transferPickUpTime"
                placeholder="HH:MM"
              />
            </div>

            <div class="mb-3">
              <label for="transferPickupFrom" class="form-label">รับจาก</label>
              <input
                type="text"
                class="form-control"
                id="transferPickupFrom"
                name="transferPickupFrom"
                placeholder="สถานที่รับ"
              />
            </div>

            <div class="mb-3">
              <label for="transferDropTo" class="form-label">ไปส่งที่</label>
              <input
                type="text"
                class="form-control"
                id="transferDropTo"
                name="transferDropTo"
                placeholder="สถานที่ส่ง"
              />
            </div>

            <div class="mb-3">
              <label for="transferNote" class="form-label">หมายเหตุ</label>
              <textarea
                class="form-control"
                id="transferNote"
                name="transferNote"
                rows="3"
                placeholder="หมายเหตุเพิ่มเติม"
              ></textarea>
            </div>

            <button type="submit" class="btn btn-primary btn-lg mt-3">
              บันทึก
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Firebase JS SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        set,
      } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
      import { generateBookingID } from "/js/id.js";

      import { database } from "/js/firebase-config.js";

      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM Loaded Successfully");

        // ดึง Elements จาก DOM
        const tourCard = document.getElementById("tourCard");
        const transferCard = document.getElementById("transferCard");
        const tourRadio = document.getElementById("formTour");
        const transferRadio = document.getElementById("formTransfer");
        const tourForm = document.getElementById("tourForm");
        const transferForm = document.getElementById("transferForm");
        tourRadio.checked = true;
        // ตรวจสอบ Elements ว่าถูกต้อง
        if (!tourCard || !transferCard || !tourRadio || !transferRadio) {
          console.error(
            "One or more DOM elements not found. Check your HTML structure."
          );
          return;
        }

        // ฟังก์ชันแสดงฟอร์ม
        function showForm(type) {
          console.log(`Switching to form: ${type}`);
          if (type === "tour") {
            tourCard.classList.remove("d-none"); // แสดง Tour Form
            transferCard.classList.add("d-none"); // ซ่อน Transfer Form
          } else if (type === "transfer") {
            tourCard.classList.add("d-none"); // ซ่อน Tour Form
            transferCard.classList.remove("d-none"); // แสดง Transfer Form
          }
        }

        // แสดงฟอร์ม Tour เป็นค่าเริ่มต้น
        showForm("tour");

        // Event Listener สำหรับปุ่มเลือกประเภทฟอร์ม
        tourRadio.addEventListener("change", function () {
          if (this.checked) {
            showForm("tour");
          }
        });

        transferRadio.addEventListener("change", function () {
          if (this.checked) {
            showForm("transfer");
          }
        });

        // Submit ฟอร์ม Tour
        tourForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          console.log("Submitting Tour Form");
          try {
            const bookingID = await generateBookingID("tour"); // ใช้ await
            console.log(`Generated Booking ID: ${bookingID}`);
            const formData = {
              tourID: bookingID,
              tourAgent: document.getElementById("tourAgent").value,
              tourType: document.getElementById("tourType").value,
              tourDetail: document.getElementById("tourDetail").value,
              tourFee: document.getElementById("tourFee").value,
              tourMeal: document.getElementById("tourMeal").value,
              tourDate: document.getElementById("tourDate").value,
              tourFirstName: document.getElementById("tourFirstNameCustomer")
                .value,
              tourLastName: document.getElementById("tourLastNameCustomer")
                .value,
              tourPax: document.getElementById("tourPax").value,
              tourHotel: document.getElementById("tourHotel").value,
              tourRoomNo: document.getElementById("tourRoomNo").value,
              tourContactNo: document.getElementById("tourContactNo").value,
              tourPickUpTime: document.getElementById("tourPickUpTime").value,
              tourSendTo: document.getElementById("tourSendTo").value,
              tourNote: document.getElementById("tourNote").value,
              status: "รอดำเนินการ",
              timestamp: { ".sv": "timestamp" },
            };

            const tourRef = ref(database, "tourBookings");
            const newTourRef = push(tourRef);
            await set(newTourRef, formData); // รอการบันทึกข้อมูลใน Firebase
            console.log("Tour booking saved successfully");
            alert(`บันทึกข้อมูลสำเร็จ! Booking ID: ${bookingID}`);
            tourForm.reset();
          } catch (error) {
            console.error("Error in Tour Form Submission:", error);
          }
        });

        // Submit ฟอร์ม Transfer
        transferForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          console.log("Submitting Transfer Form");
          try {
            const bookingID = await generateBookingID("transfer"); // ใช้ await
            console.log(`Generated Booking ID: ${bookingID}`);
            const formData = {
              transferID: bookingID,
              transferAgent: document.getElementById("transferAgent").value,
              transferType: document.getElementById("transferType").value,
              transferDetail: document.getElementById("transferDetail").value,
              transferFlight: document.getElementById("transferFlight").value,
              transferTime: document.getElementById("transferTime").value,
              transferDate: document.getElementById("transferDate").value,
              transferFirstName: document.getElementById(
                "transferFirstNameCustomer"
              ).value,
              transferLastName: document.getElementById(
                "transferLastNameCustomer"
              ).value,
              transferPax: document.getElementById("transferPax").value,
              transferPickUpTime:
                document.getElementById("transferPickUpTime").value,
              transferPickupFrom:
                document.getElementById("transferPickupFrom").value,
              transferDropTo: document.getElementById("transferDropTo").value,
              transferSendTo: document.getElementById("transferSendTo").value,
              transferNote: document.getElementById("transferNote").value,
              status: "รอดำเนินการ",
              timestamp: { ".sv": "timestamp" },
            };

            const transferRef = ref(database, "transferBookings");
            const newTransferRef = push(transferRef);
            await set(newTransferRef, formData); // รอการบันทึกข้อมูลใน Firebase
            console.log("Transfer booking saved successfully");
            alert(`บันทึกข้อมูลสำเร็จ! Booking ID: ${bookingID}`);
            transferForm.reset();
          } catch (error) {
            console.error("Error in Transfer Form Submission:", error);
          }
        });
      });
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="/component/menu.js"></script>
    <script type="module" src="/js/id.js"></script>
  </body>
</html>
